<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Personal Info</title>
  </head>
  <body>
    <h1>Enter your Personal Information</h1>
    <!--Insurer enters details-->
    <div id = "registerbox">
        <div id="register_insurer_form">
          <label>First Name:</label><input type="text" id="firstname"><br>
          <label>Last Name:</label><input type="text" id="lastname"><br>
          <label>Department:</label><input type="text" id="dept"><br>
          <label>Employee_ID:</label><input type="text" id="empid"><br>
          <label>Email:</label><input type="text" id="signup_email"><br>
          <label>Password:</label><input type="text" id="signup_password"><br>
          <label>Repeat Password:</label><input type="text" id="repeat" ><br>
          <button id="register_btn">Register</button>
        </div>
      </div>
      <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-analytics.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-firestore.js"></script>
      <script type="text/javascript">
        var firebaseConfig = {
          apiKey: "AIzaSyCIrRQLlsAzssCKjevk9AwFloPLrWSCfHk",
          authDomain: "mediscreen-674eb.firebaseapp.com",
          databaseURL: "https://mediscreen-674eb.firebaseio.com",
          projectId: "mediscreen-674eb",
          storageBucket: "mediscreen-674eb.appspot.com",
          messagingSenderId: "292545820886",
          appId: "1:292545820886:web:9fe5753b475a2f524b3177",
          measurementId: "G-FCP7TQ40TP"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const db = firebase.firestore();

        //Getting the button reference
        const registerbut = document.getElementById('register_btn');

        registerbut.addEventListener('click', e => {
          //Getting all the field references to insert into databse
          const firstname = document.getElementById('firstname').value
          const lastname = document.getElementById('lastname').value
          const dept = document.getElementById('dept').value
          const empid = document.getElementById('empid').value
          const email = document.getElementById('signup_email').value;
          const password = document.getElementById('signup_password').value;
          const reppassword = document.getElementById('repeat').value


          console.log(email,password);
          auth.createUserWithEmailAndPassword(email, password).then(cred =>{
            //We create a new insurer and add him to the database with a document id
            //matching the user id as opposed to firebase creating a unique id automatically
            return db.collection('insurers').doc(cred.user.uid).set({
              //Insurer ID is a unique random 4 digit number.
              Employee_ID: (Math.floor(Math.random() * 9999) + 1000).toString(),
              Email: email,
              Department: dept,
              First_Name: firstname,
              Last_Name: lastname,
              Password: password
            });
          }).then(()=>{
            //Redirect the insurer to the main doctor login page
            window.location = 'insurer.html';
          });
        });
      </script>

  </body>
</html>
